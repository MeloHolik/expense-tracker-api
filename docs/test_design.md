# Тест-дизайн SpendSense

## 1. Таблица решений (Decision Table) для PATCH /expenses/{id}

| Условие                  | R1  | R2  | R3  | R4  | R5  |
|:-------------------------|:---:|:---:|:---:|:---:|:---:|
| JSON распарсился         |  N  |  Y  |  Y  |  Y  |  Y  |
| Есть поля для обновления |  -  |  N  |  Y  |  Y  |  Y  |
| Payload валиден по схеме |  -  |  -  |  N  |  Y  |  Y  |
| ID существует в БД       |  -  |  -  |  -  |  N  |  Y  |
| **Результат**            |     |     |     |     |     |
| Код ответа               | 422 | 400 | 422 | 404 | 200 |
| Обновить данные в БД     |  -  |  -  |  -  |  -  |  X  |

### Детализация ответов:
* **400 Bad Request:** Тело запроса пустое `{}`. Ошибка: "No fields to update".
* **404 Not Found:** Запись с указанным ID не найдена в базе данных.
* **422 Unprocessable Entity:** 
    * (R1) Ошибка парсинга JSON (незакрытые скобки и т.д.).
    * (R3) Ошибка валидации Pydantic (например, `amount` — это строка).
* **200 OK (R5):** Успешное обновление. Обновляются только те поля, которые были переданы 
(`category`, `amount` или `comment`). Не переданные поля сохраняют старые значения.
---

## 2. Анализ полей (EP/BVA)

### Поле amount (сумма траты)
Правила: Число, обязательное поле, значение > 0 и <= 1000000.

| Тип проверки   | Входное значение (Input) | Описание                  | Ожидаемый результат  |
|----------------|--------------------------|---------------------------|----------------------|
| Valid          | 0.01                     | Минимальная граница       | 200 OK / 201 Created |
| Valid          | 1000000                  | Максимальная граница      | 200 OK / 201 Created |
| Invalid (BVA)  | 0                        | Граница (ноль)            | 422 Validation Error |
| Invalid (EP)   | -10                      | Отрицательное число       | 422 Validation Error |
| Invalid (BVA)  | 1000000.01               | Граница (больше миллиона) | 422 Validation Error |
| Invalid (Type) | "abc"                    | Строка вместо числа       | 422 Validation Error |
| Invalid (Type) | ""                       | Пустая строка             | 422 Validation Error |
| Invalid (Type) | " "                      | Пробел                    | 422 Validation Error |
| Invalid (Type) | "$%^"                    | Спецсимволы               | 422 Validation Error |

### Поле category (категория)
Правила: Строка, обязательное поле, мин. длина 1, макс. длина 15.

| Тип проверки   | Входное значение             | Ожидаемый результат |
|:---------------|:-----------------------------|:--------------------|
| Valid (BVA)    | "A" (1 символ)               | 200 OK              |
| Valid (BVA)    | "FoodAndDrinks12" (15 симв.) | 200 OK              |
| Invalid (BVA)  | "" (Пустая строка)           | 422 Error           |
| Invalid (BVA)  | "A" * 16 (16 символов)       | 422 Error           |
| Invalid (Type) | 123 (Число вместо строки)    | 422 Error           |
| Invalid (BVA)  | " " (пробел)                 | 422 Error           |

### Поле comment (комментарий)
Правила: Строка, опциональное поле, макс. длина 50.

| Тип проверки  | Входное значение                | Ожидаемый результат |
|:--------------|:--------------------------------|:--------------------|
| Valid         | None (не передано)              | 200 OK              |
| Valid (BVA)   | "A" * 50 (50 символов)          | 200 OK              |
| Valid         | "" (Пустая строка — допустимо?) | 200 OK              |
| Invalid (BVA) | "A" * 51 (51 символ)            | 422 Error           |